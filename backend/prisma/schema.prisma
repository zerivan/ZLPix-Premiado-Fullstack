generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           BigInt      @id @default(autoincrement())
  name         String
  email        String      @unique
  phone        String?
  pixKey       String?
  passwordHash String
  createdAt    DateTime    @default(now())

  bilhetes     Bilhete[]
  transactions Transaction[]
}

model Admin {
  id           BigInt     @id @default(autoincrement())
  email        String     @unique
  passwordHash String
  createdAt    DateTime   @default(now())
}

model Bilhete {
  id            BigInt       @id @default(autoincrement())
  userId        BigInt
  dezenas       String
  valor         Float
  pago          Boolean      @default(false)
  sorteioData   DateTime
  createdAt     DateTime     @default(now())

  transactionId BigInt?
  user          User         @relation(fields: [userId], references: [id])
  transaction   Transaction? @relation(fields: [transactionId], references: [id])
}

model Transaction {
  id           BigInt     @id @default(autoincrement())
  userId       BigInt
  amount       Float
  status       String     @default("pending")
  mpPaymentId  String?    @unique
  metadata     Json?
  createdAt    DateTime   @default(now())

  user         User       @relation(fields: [userId], references: [id])
  bilhetes     Bilhete[]
}